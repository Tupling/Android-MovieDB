/*
 * Project:        MoviesDB
 * 
 * Package: com.daletupling.movies
 * 
 * Author:         Dale Tupling
 * 
 * Date:        December 3rd, 2013
 * 
 */
package libs;

import java.net.MalformedURLException;
import java.net.URL;

import org.json.JSONArray;

import android.app.Activity;
import android.app.IntentService;
import android.content.Intent;
import android.os.Bundle;
import android.os.Message;
import android.os.Messenger;
import android.os.RemoteException;
import android.util.Log;



public class MovieService extends IntentService {

	String response = null;
	String finalSearch = null;
	URL finalURL = null;
	int result;
	
	JSONArray array_results;
	
	protected void MovieService(Intent intent) {
		//Passing string name of service method into super
		super(finalSearch);

		String apiURL = "http://api.themoviedb.org/3/search/movie?api_key=f9787f25661403e36a229aa8a0afd09c&query="+finalSearch;
		URL finalURL = null;
		String data_response = "";
		
		try{
			finalURL = new URL(apiURL);
			response = Data.getResponse(finalURL);
			if(response.length() > 0) result = Activity.RESULT_OK;
		} catch (MalformedURLException e){
			Log.e("BAD URL", "MALFORMED URL");
			finalURL = null;
		}
		
		return data_response;
	}

	@Override
	protected void onHandleIntent(Intent intent) {
		Bundle extras = intent.getExtras();
		if(extras != null){
			Messenger messenger = (Messenger) extras.get("MESSENGER");
			Message message = Message.obtain();
			message.arg1 = result;
			message.obj = response;
			try{
				messenger.send(message);
			}catch (RemoteException e1){
				Log.w(getClass().getName(), "Exception sending message", e1);
			}
		}
		
	}

}
